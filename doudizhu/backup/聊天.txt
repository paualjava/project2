苍泊 16:59:00
你看下个流程，基本上右边基本上都你需要处理的。
苍泊 16:59:23
大概有3，4个接口
牛头人酋长 16:59:34
你返给我 一个 参数“receipt-data” 我处理完，返回给你结果
苍泊 17:01:14
恩，是的。
苍泊 13:27:05
商城的接口是有问题的，你看一下那个流程，按照那个流程来。现在的这一个接口只是简单的验证，如果这样地话，我本地就可以做验证。
牛头人酋长 13:28:03
好的，那我再看一下吧，但是 那个 流程上，有些我没明白，我这边需要写些什么
苍泊 13:34:23
哪些你没明白？
苍泊 13:40:55
我给你说一下，你具体做哪些吧
牛头人酋长 13:41:21
好的
苍泊 13:41:46
第一步，在交易将要开始的时候，客户端会将该用户的id，该用户将要购买什么商品的id，上传给你。你返回一个这次交易的序列号给我就行。这时你服务器上这次交易的状态应该是开始购买。
buyProductStart
buyProductFailure
buy_info
bid,user_id,product_id,serial_number,type(1开始，2成功，3失败),postdate

参考:
shop_buy($map)
苍泊 13:42:35
这个接口Ok吗？
牛头人酋长 13:42:54
我返回一个这次交易的序列号给我  根据 商品Id，和用户 ID 拼一个吗？规则是什么
苍泊 13:44:41
这个你自己定吧。也可以是序号。方便你那边好查询的。
牛头人酋长 13:45:24
好 ，那就说明我这边，还要建表的，方便以后 查询
苍泊 13:45:55
恩，是的
苍泊 13:46:12
这条ok了吧
牛头人酋长 13:47:28
恩是
苍泊 13:49:40
第二个接口，就是当客户端用户取消掉交易。客户端会将用户的id，第一个接口返回来的交易序列号上传给你。走这个接口，表示这次交易购买失败。
牛头人酋长 13:51:33
好的，
苍泊 13:56:57
第三个接口，就是客户端发起了交易。交易成功后，我会将用户的id,这次交易的序列号，。。。。。，还有就是苹果那边的返回的交易凭证上传给你。服务器就需要去验证凭证了，将凭证的信息跟你服务器的数据库的数据进行对比，对比的就是那几点，都是我上传给你的。（这个你第一个接口就上传上去，还是这个接口上传上去）但是我本地获得的订单号，需要在这个时候才能传给你。
苍泊 13:58:03
然后你判断好了，就给相应地用户加上钻石。然后在返回给我状态。
牛头人酋长 13:59:45
好的
苍泊 14:02:13
你需要判断的参数，没有的话就在接口中添加参数，我给你传。比如你不知道用户到底购买了多少钻石。
牛头人酋长 14:04:55
好的
苍泊 14:06:11
这个时候你服务器这次交易应该有这样几种状态区分，购买成功，假购买。如果凭证返回来的订单号，在你的数据库已经存在，那么这个用户就涉嫌用第三方工具进行刷单。这些状态那个流程上都有的。
苍泊 14:10:06
有可能这个用户的这次交易，我会上传多次。由于网络的因素，及用户的操作，有可能我没有收到服务器返回来的消息。当该用户在此上线的时候，我会把没有满足上传成功的交易再次上传。有可能这次交易是已经上传过的。这些你也是要判断，并返回相应地状态值给我。
苍泊 14:10:52
大概就这几个接口。
牛头人酋长 14:11:05
好的
苍泊 14:16:39
好的，在不清楚地地方，我们在沟通。第一个，第2个接口。是没有问题的。这样把，第一个接口的时候，我就将bundle_id，product_id，传给你。transaction_id我需要在第
